/*
SIMPLE KEYBOARD DISPLAY CONTROL
ALEX K JAN-2002
*/
//-----------------------------------------------------------------------------------------
#define CONTROLCLS Keyboard     ////CLASS NAME (TO EDIT) 
#define BMPLENGH 140              ////HALF OF BITMAP LENGH (TO EDIT)
#define BMPHIGH 96               ////HIGH OF BITMAP (TO EDIT)
#define num_octaves 4  
#define WM_MIDIKEYPRESSED 121256           ////MESSAGE TO PARENT (TO EDIT)
#define WM_MIDIKEYUP 121257           ////MESSAGE TO PARENT (TO EDIT)
#define CNTRLCLSNAME "kbrd_"  ////CLASS NAME TO REGISTER (TO EDIT)
#define BITMAPARRAY bz_kbrd     ////NAME OF BITMAP ARRAY (TO EDIT)
#define BITMAPARRAY2 bz_dzdn
#define BITMAPARRAY3 bz_wtkey_dn
#include <Commctrl.h>
//int diezy[5]={14,34,74,94,114};
//-----------------------------------------------------------------------------------------
class CONTROLCLS 
{
public:
 
   CONTROLCLS();
   HWND  add_keyboard(HWND hParent, int a,int b, int id);/// CREATE
   void  SetNoteOn(int ind,int note);                  /// SET METHOD
   void  SetNoteOff(int ind, int note);                 /// SET METHOD 
   void  SetAllOff(int ind );

   private:              ////   DONT EDIT BELOW
   HWND slHns[64];///ctrl handles
   ///void* hInstance;
   HANDLE BMPhsl;
   HANDLE BMPdiez;
   HANDLE BMPwtdown;
   
   int pressed_note[64];
   int pressed[64];
   long Decode(unsigned char *inpak,unsigned char* outdata,long ENDFA);
   HANDLE extro_lbs(HDC hDC,LPSTR bzin);
   void gaa_sl(HWND hWin );
   void gaa_diez(HWND hWin ,int octnum,int x_diez,int onoff);
   void gaa_white(HWND hWin ,int octnum,int x_num,int onoff);
   int handle2index_sl(HWND hS);
   static LONG CALLBACK HandleKeyboard(HWND hWlb, UINT msg, WPARAM wParam, LPARAM lParam);

};
//-----------------------------------------------------------------------------------------
extern void* hInstance;   ///BKGRGB
//-----------------------------------------------------------------------------------------
unsigned char BITMAPARRAY[]  = { 95,
66,77,182,157,0,242,242,54,242,240,213,40,242,240,140,242,240,96,242,240,1,0,53,24,242,242,128,241,240,196,14,18,3,26,8,255,255,
255,255,240,247,240,191,167,113,144,45,15,63,15,75,6,95,96,95,36,15,56,111,15,129,15,90,9,231,224,211,135,15,180,15,14,195,9,
128,136,128,96,15,231,15,249,15,90,15,0,29,31,47,31,8,31,26,31,101,31,62,31,156,15,155,31,0,173,31,210,9,143,31,221,31,
182,31,200,31,19,47,37,47,0,254,31,43,47,91,47,52,47,70,47,145,47,106,47,124,47,0,199,47,217,47,178,47,223,47,15,63,232,
47,250,47,69,63,0,30,63,48,63,123,63,141,63,102,63,147,63,195,63,156,63,0,174,63,249,63,210,63,228,63,47,79,65,79,26,79,
71,79,0,119,79,80,79,98,79,173,79,134,79,152,79,227,79,245,79,0,206,79,25,95,43,95,55,86,13,95,88,95,106,95,67,95,0,
115,95,160,95,121,95,139,95,214,95,232,95,193,95,12,111,0,30,111,247,95,39,111,84,111,45,111,63,111,138,111,156,111,0,117,111,192,
111,210,111,171,111,219,111,8,127,225,111,243,111,0,62,127,80,127,41,127,116,127,134,127,95,127,143,127,188,127,0,149,127,167,127,242,127,
4,143,221,127,40,143,58,143,19,143,0,67,143,112,143,73,143,91,143,166,143,184,143,145,143,220,143,0,238,143,199,143,247,143,36,159,253,
143,15,159,90,159,108,159,0,69,159,144,159,162,159,123,159,171,159,216,159,177,159,195,159,0,14,175,32,175,249,159,68,175,86,175,47,175,
95,175,140,175,0,101,175,119,175,194,175,212,175,173,175,248,175,10,191,227,175,0,19,191,64,191,25,191,43,191,118,191,136,191,97,191,172,
191,0,190,191,151,191,199,191,244,191,205,191,223,191,42,207,60,207,0,21,207,96,207,114,207,75,207,123,207,168,207,129,207,147,207,0,222,
207,240,207,201,207,20,223,38,223,255,207,47,223,92,223,0,53,223,71,223,146,223,164,223,125,223,200,223,218,223,179,223,0,227,223,16,239,
233,223,251,223,70,239,88,239,49,239,124,239,0,142,239,103,239,151,239,196,239,157,239,175,239,250,239,12,255,0,229,239,48,255,66,255,27,
255,75,255,120,255,81,255,99,255,0,174,255,192,255,153,255,228,255,246,255,207,255,255,255,44,15,0,5,15,23,15,98,15,116,15,77,15,
152,15,170,15,131,15,0,179,15,224,15,185,15,203,15,22,31,40,31,1,31,76,31,0,94,31,55,31,103,31,148,31,109,31,127,31,202,
31,220,31,0,181,31,0,47,18,47,235,31,27,47,72,47,33,47,51,47,0,126,47,144,47,105,47,180,47,198,47,159,47,207,47,252,47,
0,213,47,231,47,50,63,68,63,29,63,104,63,122,63,83,63,0,131,63,176,63,137,63,155,63,230,63,248,63,209,63,28,79,0,46,79,
7,79,55,79,100,79,61,79,79,79,154,79,172,79,0,133,79,208,79,226,79,187,79,235,79,24,95,241,79,3,95,0,78,95,96,95,57,
95,132,95,150,95,111,95,159,95,204,95,0,165,95,183,95,2,111,20,111,237,95,56,111,74,111,35,111,0,83,111,128,111,89,111,107,111,
182,111,200,111,161,111,236,111,0,254,111,215,111,7,127,52,127,13,127,31,127,106,127,124,127,0,85,127,160,127,178,127,139,127,187,127,232,
127,193,127,211,127,0,30,143,48,143,9,143,84,143,102,143,63,143,111,143,156,143,0,117,143,135,143,210,143,228,143,189,143,8,159,26,159,
243,143,0,35,159,80,159,41,159,59,159,134,159,152,159,113,159,188,159,0,206,159,167,159,215,159,4,175,221,159,239,159,58,175,76,175,0,
37,175,112,175,130,175,91,175,139,175,184,175,145,175,163,175,0,238,175,0,191,217,175,36,191,54,191,15,191,63,191,108,191,0,69,191,87,
191,162,191,180,191,141,191,216,191,234,191,195,191,0,243,191,32,207,249,191,11,207,86,207,104,207,65,207,140,207,0,158,207,119,207,167,207,
212,207,173,207,191,207,10,223,28,223,0,245,207,64,223,82,223,43,223,91,223,136,223,97,223,115,223,0,190,223,208,223,169,223,244,223,6,
239,223,223,15,239,60,239,0,21,239,39,239,114,239,132,239,93,239,168,239,186,239,147,239,0,195,239,240,239,201,239,219,239,38,255,56,255,
17,255,92,255,0,110,255,71,255,119,255,164,255,125,255,143,255,218,255,236,255,0,197,255,16,15,34,15,251,255,43,15,88,15,49,15,67,
15,0,142,15,160,15,121,15,196,15,214,15,175,15,223,15,12,31,0,229,15,247,15,66,31,84,31,45,31,120,31,138,31,99,31,0,147,
31,192,31,153,31,171,31,246,31,8,47,225,31,44,47,0,62,47,23,47,71,47,116,47,77,47,95,47,170,47,188,47,0,149,47,224,47,
242,47,203,47,251,47,40,63,1,63,19,63,0,94,63,112,63,73,63,148,63,166,63,127,63,175,63,220,63,0,181,63,199,63,18,79,36,
79,253,63,72,79,90,79,51,79,0,99,79,144,79,105,79,123,79,198,79,216,79,177,79,252,79,0,14,95,231,79,23,95,68,95,29,95,
47,95,122,95,140,95,0,101,95,176,95,194,95,155,95,203,95,248,95,209,95,227,95,0,46,111,64,111,25,111,100,111,118,111,79,111,127,
111,172,111,0,133,111,151,111,226,111,244,111,205,111,24,127,42,127,3,127,0,51,127,96,127,57,127,75,127,150,127,168,127,129,127,204,127,
0,222,127,183,127,231,127,20,143,237,127,255,127,74,143,92,143,0,53,143,128,143,146,143,107,143,155,143,200,143,161,143,179,143,0,254,143,
16,159,233,143,52,159,70,159,31,159,79,159,124,159,0,85,159,103,159,178,159,196,159,157,159,232,159,250,159,211,159,0,3,175,48,175,9,
175,27,175,102,175,120,175,81,175,156,175,0,174,175,135,175,183,175,228,175,189,175,207,175,26,191,44,191,0,5,191,80,191,98,191,59,191,
107,191,152,191,113,191,131,191,0,206,191,224,191,185,191,4,207,22,207,239,191,31,207,76,207,0,37,207,55,207,130,207,148,207,109,207,184,
207,202,207,163,207,0,211,207,0,223,217,207,235,207,54,223,72,223,33,223,108,223,0,126,223,87,223,135,223,180,223,141,223,159,223,234,223,
252,223,0,213,223,32,239,50,239,11,239,59,239,104,239,65,239,83,239,0,158,239,176,239,137,239,212,239,230,239,191,239,239,239,28,255,0,
245,239,7,255,82,255,100,255,61,255,136,255,154,255,115,255,0,163,255,208,255,169,255,187,255,6,15,24,15,241,255,60,15,0,78,15,39,
15,87,15,132,15,93,15,111,15,186,15,204,15,0,165,15,240,15,2,31,219,15,11,31,56,31,17,31,35,31,0,110,31,128,31,89,31,
164,31,182,31,143,31,191,31,236,31,0,197,31,215,31,34,47,52,47,13,47,88,47,106,47,67,47,0,115,47,160,47,121,47,139,47,214,
47,232,47,193,47,12,63,0,30,63,247,47,39,63,84,63,45,63,63,63,138,63,156,63,0,117,63,192,63,210,63,171,63,219,63,8,79,
225,63,243,63,0,62,79,80,79,41,79,116,79,134,79,95,79,143,79,188,79,0,149,79,167,79,242,79,4,95,221,79,40,95,58,95,19,
95,0,67,95,112,95,73,95,91,95,166,95,184,95,145,95,220,95,0,238,95,199,95,247,95,36,111,253,95,15,111,90,111,108,111,0,69,
111,144,111,162,111,123,111,171,111,216,111,177,111,195,111,0,14,127,32,127,249,111,68,127,86,127,47,127,95,127,140,127,128,101,127,119,127,
194,127,212,127,173,127,248,127,7,137,239,255,239,239,223,223,223,208,215,208,14,31,128,112,120,112,236,112,28,128,28,134,31,131,0,28,128,
25,128,7,143,25,143,43,143,61,143,136,143,233,127,0,172,143,73,143,91,143,109,143,187,143,205,143,223,143,241,143,0,3,159,21,159,39,
159,114,159,151,143,123,159,168,159,72,144,191,175,176,175,144,152,144,195,144,80,11,87,80,144,144,159,207,146,195,147,195,147,192,144,0,72,
144,171,159,189,159,207,159,225,159,44,175,141,159,80,175,0,237,159,255,159,17,175,95,175,113,175,131,175,149,175,167,175,192,185,175,203,175,
22,191,59,175,31,191,76,188,15,16,57,15,94,191,112,188,127,120,127,239,160,75,144,0,79,191,154,191,115,191,133,191,208,191,49,191,244,
191,145,191,0,24,207,181,191,3,207,78,207,39,207,57,207,75,207,150,207,224,111,207,186,207,223,191,195,207,240,204,47,23,16,0,156,207,
159,207,177,207,255,207,74,223,35,223,110,223,207,207,0,119,223,47,223,80,223,83,223,101,223,179,223,254,223,215,223,0,233,223,52,239,13,
239,164,223,125,223,143,223,142,239,118,224,63,111,72,64,96,111,111,64,239,70,239,0,88,239,166,239,241,239,202,239,21,255,118,239,57,255,
214,239,0,244,239,250,239,12,255,90,255,165,255,126,255,144,255,219,255,224,180,255,255,255,36,255,54,255,53,15,127,95,95,15,144,152,159,
111,214,255,235,255,121,206,74,15,0,149,15,110,15,185,15,26,15,221,15,122,15,140,15,158,15,0,176,15,254,15,73,31,34,31,52,31,
127,31,88,31,163,31,240,200,15,218,15,217,31,118,16,191,192,175,159,27,144,128,46,224,47,24,249,26,145,31,223,31,0,241,31,3,47,
21,47,96,47,193,31,132,47,33,47,51,47,0,69,47,147,47,165,47,183,47,201,47,219,47,237,47,255,47,240,74,63,111,47,83,63,11,
63,208,207,191,191,127,167,144,79,47,31,79,48,157,50,62,156,48,47,31,64,48,31,53,63,131,63,0,149,63,167,63,185,63,4,79,101,
63,40,79,197,63,215,63,0,233,63,55,79,73,79,91,79,109,79,127,79,145,79,163,79,224,238,79,19,79,247,79,175,79,193,64,176,167,
143,71,64,40,31,63,84,212,64,212,64,40,216,79,0,174,79,56,95,74,95,92,95,167,95,8,95,203,95,104,95,0,122,95,140,95,98,
95,236,95,254,95,16,111,34,111,52,111,0,70,111,145,111,182,95,200,95,218,95,100,111,118,111,136,111,0,214,111,232,111,250,111,69,127,
166,111,184,111,202,111,24,127,0,42,127,60,127,138,127,156,127,174,127,192,127,210,127,228,127,224,66,127,84,127,102,127,101,143,2,136,160,
143,64,1,39,23,135,21,131,33,143,111,143,129,143,147,143,165,143,0,240,143,81,143,20,159,177,143,195,143,213,143,35,159,53,159,0,71,
159,89,159,107,159,125,159,143,159,218,159,255,143,227,159,0,155,159,173,148,22,136,191,159,209,159,31,175,49,175,67,175,0,142,175,239,159,
151,175,79,175,97,175,115,175,133,175,211,175,0,229,175,247,175,9,191,27,191,45,191,196,175,157,175,175,175,0,174,191,3,143,21,143,111,
191,189,191,207,191,225,191,180,191,0,141,191,159,191,98,207,255,191,17,207,35,207,113,207,131,207,0,149,207,167,207,185,207,203,207,221,207,
40,223,77,207,76,223,0,233,207,251,207,13,223,91,223,109,223,127,223,145,223,220,223,0,61,223,0,239,157,223,175,223,193,223,15,239,33,
239,51,239,0,69,239,87,239,105,239,123,239,198,239,235,223,207,239,135,239,2,153,226,144,179,159,177,239,255,239,17,255,35,255,53,255,0,
128,255,225,239,164,255,65,255,83,255,101,255,179,255,197,255,0,215,255,233,255,251,255,13,15,31,15,106,15,143,255,115,15,14,43,15,208,
208,176,64,1,88,191,86,15,164,15,0,182,15,200,15,218,15,116,15,134,15,73,31,230,15,248,15,0,10,31,88,31,106,31,124,31,142,
31,160,31,178,31,196,31,32,15,47,52,31,21,47,208,31,154,232,79,166,230,247,31,0,205,31,87,47,105,47,123,47,198,47,39,47,234,
47,135,47,0,153,47,171,47,129,47,11,63,29,63,47,63,65,63,83,63,0,101,63,176,63,213,47,231,47,249,47,151,232,145,48,145,63,
0,163,63,241,63,3,79,21,79,232,63,193,63,211,63,150,79,0,51,79,69,79,87,79,165,79,183,79,201,79,219,79,237,79,0,255,79,
17,95,92,95,129,79,128,95,49,15,67,15,65,95,0,143,95,161,95,179,95,197,95,16,111,113,95,52,111,209,95,0,227,95,245,95,67,
111,85,111,103,111,121,111,139,111,157,111,0,175,111,250,111,31,111,3,127,187,111,225,20,212,111,230,111,0,52,127,70,127,88,127,106,127,
4,127,22,127,217,127,118,127,0,136,127,154,127,232,127,250,127,12,143,30,143,48,143,66,143,0,84,143,159,143,196,127,165,143,96,143,154,
239,172,239,150,143,0,228,143,246,143,8,159,83,159,180,143,89,159,20,159,38,159,0,56,159,74,159,152,159,170,159,188,159,206,159,224,159,
242,159,32,134,159,98,159,116,159,115,175,36,92,47,149,161,36,163,0,53,80,45,175,123,175,141,175,159,175,177,175,252,175,93,175,0,32,
191,189,175,207,175,225,175,47,191,65,191,83,191,101,191,0,119,191,137,191,155,191,230,191,11,191,239,191,167,191,205,111,0,131,143,221,191,
43,207,61,207,79,207,154,207,251,191,163,207,0,91,207,109,207,127,207,145,207,223,207,241,207,3,223,21,223,128,39,223,57,223,208,207,169,
207,187,207,186,223,87,211,207,1,207,115,141,53,83,117,223,195,223,213,223,231,223,249,223,0,68,239,165,223,104,239,5,239,23,239,41,239,
119,239,137,239,0,155,239,173,239,191,239,209,239,227,239,46,255,83,239,55,255,0,239,239,93,212,140,51,198,182,23,255,237,239,119,255,137,
255,0,155,255,230,255,71,255,10,15,167,255,185,255,203,255,161,255,0,43,15,61,15,79,15,97,15,115,15,133,15,208,15,245,255,0,7,
15,25,15,183,191,181,15,199,15,21,31,39,31,57,31,0,132,31,229,15,247,15,9,31,87,31,105,31,123,31,201,31,0,219,31,237,31,
255,31,17,47,35,47,129,31,147,31,165,31,12,164,47,105,136,191,168,98,210,34,168,22,255,112,47,0,190,47,208,47,226,47,45,63,142,
47,81,63,238,47,0,63,0,18,63,36,63,114,63,132,63,150,63,168,63,186,63,204,63,0,23,79,60,63,78,63,77,79,254,225,238,48,
97,223,3,79,0,217,63,99,79,117,79,135,79,210,79,51,79,246,79,147,79,0,165,79,183,79,141,79,23,95,41,95,59,95,77,95,95,
95,0,113,95,188,95,225,79,243,79,5,95,71,47,37,175,179,95,0,1,111,19,111,37,111,112,111,209,95,227,95,245,95,67,111,0,85,
111,103,111,181,111,199,111,217,111,235,111,253,111,15,127,0,109,111,127,111,145,111,144,127,45,127,83,47,81,127,159,127,0,177,127,195,127,
93,127,111,127,129,127,68,143,225,127,243,127,0,5,143,83,143,101,143,119,143,137,143,155,143,173,143,191,143,0,10,159,47,143,46,159,203,
142,240,52,233,133,197,179,241,143,0,63,159,81,159,99,159,117,159,192,159,33,159,228,159,129,159,0,147,159,165,159,243,159,5,175,23,175,
41,175,59,175,77,175,0,95,175,170,175,207,159,179,175,107,175,145,84,230,136,143,175,0,161,175,239,175,1,191,19,191,94,191,191,175,103,
191,31,191,0,49,191,67,191,85,191,163,191,181,191,199,191,217,191,235,191,0,253,191,148,191,109,191,127,191,126,207,159,12,62,115,162,198,
0,57,207,135,207,153,207,171,207,189,207,8,223,105,207,44,223,0,201,207,219,207,237,207,59,223,77,223,95,223,113,223,131,223,0,149,223,
167,223,242,223,23,223,251,223,179,223,217,140,212,223,0,230,223,52,239,70,239,88,239,163,239,4,239,22,239,217,239,0,118,239,136,239,154,
239,232,239,250,239,12,255,30,255,48,255,64,66,255,84,255,178,239,196,239,195,255,136,87,207,239,50,0,253,53,120,255,138,255,216,255,234,
255,252,255,71,15,168,255,0,186,255,125,15,26,15,44,15,62,15,140,15,158,15,176,15,0,194,15,212,15,230,15,248,15,86,15,104,15,
103,31,4,31,0,42,207,40,31,118,31,136,31,154,31,172,31,70,31,88,31,0,27,47,184,31,202,31,220,31,42,47,60,47,78,47,96,
47,128,114,47,132,47,150,47,225,47,6,47,5,63,90,255,191,0,221,128,190,38,161,82,34,31,216,47,38,63,56,63,74,63,0,149,63,
246,47,185,63,86,63,104,63,122,63,140,63,218,63,0,236,63,254,63,16,79,34,79,52,79,127,79,164,63,182,63,0,181,79,82,79,28,
31,118,79,196,79,214,79,232,79,51,95,0,148,79,166,79,105,95,6,95,24,95,42,95,120,95,138,95,0,156,95,174,95,192,95,210,95,
228,95,66,95,84,95,83,111,0,168,47,2,111,20,111,98,111,116,111,134,111,152,111,50,111,0,68,111,7,127,164,111,182,111,200,111,22,
127,40,127,58,127,0,76,127,94,127,112,127,130,127,205,127,242,111,241,127,18,207,0,36,195,166,121,198,47,196,127,18,143,36,143,54,143,
129,143,0,226,127,165,143,66,143,84,143,102,143,120,143,198,143,216,143,0,234,143,252,143,14,159,32,159,107,159,144,143,162,143,161,159,4,
246,85,162,123,48,177,127,103,159,181,159,199,159,217,159,0,36,175,133,159,42,175,229,159,247,159,9,175,27,175,105,175,0,123,175,141,175,
159,175,177,175,195,175,87,175,51,175,69,175,156,68,191,245,85,168,143,64,248,162,244,164,48,0,85,159,11,191,89,191,107,191,125,191,200,
191,41,191,206,191,0,137,191,155,191,173,191,191,191,13,207,31,207,49,207,67,207,0,85,207,103,207,251,191,215,191,233,191,232,207,133,198,
162,116,0,7,214,158,207,176,207,254,207,16,223,34,223,109,223,206,207,0,145,223,46,223,64,223,82,223,100,223,178,223,196,223,214,223,0,
232,223,250,223,12,239,87,239,124,223,142,223,141,239,226,169,0,186,38,189,35,69,239,147,239,165,239,183,239,201,239,20,255,0,117,239,56,
255,213,239,231,239,249,239,71,255,89,255,107,255,0,125,255,143,255,161,255,179,255,254,255,35,255,7,15,191,255,0,229,175,227,255,245,255,
67,15,85,15,103,15,178,15,19,15,0,187,15,115,15,133,15,151,15,169,15,247,15,9,31,27,31,0,45,31,63,31,81,31,232,15,193,
15,211,15,210,31,131,202,0,124,31,142,31,220,31,238,31,0,47,18,47,172,31,190,31,0,129,47,30,47,48,47,66,47,144,47,162,47,
180,47,198,47,0,216,47,234,47,252,47,71,63,108,47,77,63,8,63,230,171,2,218,244,48,48,63,6,63,144,63,162,63,180,63,255,63,
0,96,63,35,79,192,63,210,63,228,63,186,63,68,79,86,79,0,104,79,122,79,140,79,158,79,233,79,14,79,32,79,50,79,4,208,253,
163,116,55,212,79,170,79,52,95,70,95,88,95,0,163,95,4,95,199,95,100,95,118,95,136,95,94,95,232,95,0,250,95,12,111,30,111,
48,111,66,111,141,111,178,95,196,95,0,214,95,208,250,54,228,248,160,119,111,77,111,215,111,233,111,0,251,111,70,127,167,111,106,127,7,
127,25,127,43,127,1,127,0,139,127,157,127,175,127,193,127,211,127,229,127,48,143,85,127,0,103,127,121,127,23,62,143,193,24,143,42,143,
120,143,138,143,0,156,143,231,143,72,143,237,143,168,143,186,143,204,143,222,143,0,44,159,62,159,80,159,98,159,116,159,134,159,26,159,246,
143,8,8,159,7,175,184,73,40,183,145,109,111,199,159,21,175,0,39,175,57,175,12,175,229,159,247,159,186,175,87,175,105,175,0,123,175,
201,175,219,175,237,175,255,175,17,191,35,191,53,191,0,128,191,165,175,164,191,65,191,215,241,87,176,87,178,149,195,0,101,191,179,191,197,
191,215,191,233,191,52,207,149,191,88,207,0,245,191,7,207,25,207,103,207,121,207,139,207,157,207,175,207,0,193,207,211,207,30,223,67,207,
39,223,223,207,5,141,185,147,0,7,223,221,207,103,223,121,223,139,223,214,223,55,223,250,223,0,151,223,169,223,187,223,145,223,27,239,45,
239,63,239,81,239,192,99,239,117,239,192,239,229,223,247,223,9,239,95,95,1,223,170,159,168,239,186,239,8,255,26,255,44,255,119,255,0,
216,239,125,255,56,255,74,255,92,255,110,255,188,255,206,255,0,224,255,242,255,4,15,22,15,170,255,134,255,152,255,151,15,6,184,67,208,
176,80,183,254,198,99,191,37,15,175,15,0,193,15,211,15,30,31,127,15,66,31,223,15,241,15,3,31,0,217,15,99,31,117,31,135,31,
153,31,171,31,189,31,8,47,0,45,31,63,31,81,31,239,207,237,31,255,31,77,47,95,47,0,113,47,188,47,29,47,47,47,65,47,143,
47,161,47,179,47,0,1,63,19,63,37,63,55,63,73,63,91,63,185,47,203,47,0,221,47,220,63,161,154,154,239,152,63,110,63,248,63,
10,79,0,28,79,103,79,200,63,139,79,40,79,58,79,76,79,34,79,0,172,79,190,79,208,79,226,79,244,79,6,95,81,95,118,79,8,
136,79,154,79,128,49,176,61,15,59,95,17,95,155,95,0,173,95,191,95,10,111,107,95,46,111,203,95,221,95,239,95,0,197,95,79,111,
97,111,115,111,133,111,151,111,169,111,244,111,16,25,111,43,111,61,111,75,181,79,228,31,226,111,48,127,0,66,127,84,127,102,127,0,127,
18,127,213,127,114,127,132,127,0,150,127,228,127,246,127,8,143,26,143,44,143,62,143,80,143,0,155,143,192,127,161,143,92,143,110,131,136,
63,134,143,212,143,0,230,143,248,143,10,159,164,143,182,143,121,159,22,159,40,159,0,58,159,136,159,154,159,172,159,190,159,208,159,226,159,
244,159,156,63,175,100,158,240,248,240,101,175,116,169,143,255,112,111,224,224,208,207,192,175,191,96,87,63,112,88,64,146,160,96,255,88,63,
111,95,63,112,95,64,254,41,167,127,127,159,159,159,223,216,193,223,119,175,137,175,155,175,173,175,248,175,191,184,1,191,92,175,31,191,188,
175,206,175,224,175,46,191,64,191,128,82,191,100,191,118,191,136,191,154,191,229,191,10,179,111,155,112,111,111,147,255,248,8,207,23,202,160,
255,135,128,239,224,207,176,159,128,253,112,200,176,88,63,112,87,63,111,254,55,192,88,48,127,88,63,63,31,249,16,41,163,217,176,176,183,
176,224,224,193,224,27,207,45,207,63,207,81,207,156,207,240,247,1,240,0,207,195,207,96,207,114,207,132,207,210,207,228,207,0,246,207,8,
223,26,223,44,223,62,223,137,223,174,195,0 }; 
//Total :5155 bytes. LSZ PACKED
unsigned char BITMAPARRAY2[] = { 95,
66,77,218,22,0,242,242,54,242,240,213,40,242,240,30,242,240,63,242,240,1,0,53,24,242,242,164,241,240,196,14,18,3,26,5,
255,240,247,240,239,239,239,223,223,239,223,208,215,208,45,0,112,120,112,192,242,240,42,0,42,6,45,3,42,0,39,0,231,224,93,
211,81,9,128,136,128,242,240,255,102,2,236,81,12,81,0,0,0,39,0,224,231,224,119,223,224,223,134,3,127,127,127,242,240,7,
224,232,224,149,0,134,6,131,0,78,6,39,15,224,57,15,75,3,26,7,227,15,26,7,192,199,192,248,131,0,81,3,179,0,175,
176,175,144,152,93,144,18,16,80,87,80,242,240,159,30,18,240,18,19,18,19,15,16,179,0,0,0,111,72,255,64,175,175,144,143,
127,111,16,239,0,0,16,8,67,20,31,7,0,59,16,7,26,7,176,183,176,134,0,81,0,231,15,16,15,101,31,119,28,127,120,
127,248,18,16,182,0,54,18,191,184,160,175,144,63,128,48,24,0,48,31,159,18,158,16,28,158,18,83,31,47,23,16,119,31,122,
31,140,22,255,79,79,192,184,160,160,151,127,225,47,167,19,250,24,175,31,56,16,96,111,111,136,211,31,217,31,235,23,175,246,31,
8,47,81,0,127,63,95,95,144,152,159,111,33,47,54,47,188,144,20,243,17,144,127,47,16,165,17,47,248,164,22,101,47,119,34,
191,192,175,159,144,141,128,193,16,47,24,224,42,148,47,166,41,23,248,182,33,183,47,109,44,208,207,191,191,167,63,144,79,47,31,
79,48,60,50,59,48,31,47,31,64,48,31,240,47,2,63,20,63,126,38,62,176,167,143,64,40,31,150,52,4,71,48,71,48,40,
75,63,93,63,111,63,129,63,147,63,224,165,63,183,63,201,63,219,63,237,48,160,143,64,1,39,250,55,248,51,4,79,166,38,83,
47,49,79,67,73,0,249,56,90,79,68,47,126,79,144,79,234,63,252,63,14,79,64,176,36,223,79,241,79,3,95,21,95,39,86,
191,29,79,4,67,95,85,89,144,78,79,116,95,238,27,145,80,180,41,12,163,95,49,49,208,176,187,81,171,79,209,95,207,79,136,
245,95,171,95,97,84,79,105,86,42,111,112,75,16,0,147,95,93,111,91,87,124,96,124,111,142,111,140,83,54,91,0,171,96,183,
111,181,95,35,111,217,95,235,83,94,114,180,35,0,145,80,19,127,17,103,47,127,65,127,63,111,81,111,27,127,0,97,95,155,127,
153,111,168,97,238,82,16,127,198,109,68,51,0,240,114,216,96,248,127,146,21,174,35,168,105,36,143,34,127,128,144,127,162,127,88,
120,102,116,164,18,131,143,121,32,207,33,207,134,125,216,99,176,143,238,19,191,218,32,184,127,192,222,143,148,136,119,99,73,134,10,
159,28,150,160,175,7,151,128,48,146,80,181,40,128,143,54,143,92,159,224,90,143,140,82,133,145,117,143,155,159,208,176,191,1,168,
157,130,27,105,194,159,236,23,38,156,27,131,243,159,0,241,129,9,160,156,143,30,175,172,119,58,175,56,159,166,159,0,72,134,245,
127,39,88,130,148,229,159,175,175,193,175,191,159,0,209,154,154,19,248,175,10,191,52,49,12,163,44,181,72,131,0,52,191,50,175,
60,95,86,175,104,160,41,184,138,191,136,175,0,174,191,192,191,78,152,67,51,57,198,236,191,238,18,151,17,0,131,144,94,115,172,
111,34,207,32,184,63,207,137,31,99,195,132,85,191,195,191,207,10,162,24,165,155,207,185,143,151,1,127,7,119,97,117,211,207,229,
202,222,191,4,223,210,68,8,12,204,44,223,46,56,143,80,215,87,149,92,223,90,203,0,124,223,142,223,160,220,247,207,61,191,155,
19,5,127,51,223,0,233,197,5,239,23,239,241,18,46,237,166,175,204,190,97,233,0,89,223,107,220,164,24,153,239,43,60,94,234,
65,50,204,239,112,130,230,211,213,107,207,1,255,191,168,143,73,48,34,28,247,48,200,239,230,170,79,190,63,85,255,115,185,0,70,
133,72,134,132,255,130,239,214,213,176,255,10,252,43,182,0,46,191,216,239,254,255,16,15,14,255,52,15,234,255,212,222,192,65,239,
103,249,135,15,153,15,151,250,95,9,63,32,1,15,199,15,125,15,75,132,74,63,168,15,103,1,101,1,17,31,31,31,29,15,76,
216,55,79,31,77,12,29,17,0,240,226,121,31,139,31,206,247,62,48,170,31,96,30,168,248,0,216,31,214,15,70,51,2,47,20,
47,240,232,49,33,197,15,0,51,25,231,112,127,242,163,31,253,15,107,25,243,226,144,47,128,234,29,127,240,127,242,58,51,192,47,
30,149,198,31,63,1,31,54,47,236,31,90,37,26,63,120,152,127,43,101,1,9,32,238,47,4,161,223,77,47,115,63,113,47,131,
41,1,15,164,63,2,167,172,38,17,54,190,47,112,74,221,46,0,74,63,0,63,38,79,180,31,54,63,92,79,194,252,105,63,0,
143,79,233,63,47,36,2,79,220,117,192,63,230,79,248,79,192,154,63,28,95,18,241,216,97,126,79,52,77,127,96,254,127,2,175,
144,80,64,32,95,71,245,47,192,80,80,193,80,72,47,96,72,253,48,114,86,191,184,191,224,224,224,199,240,248,240,133,87,123,79,
161,95,0,144,251,112,111,188,48,160,136,111,95,72,250,191,82,64,194,81,95,71,32,96,72,247,47,32,8,209,85,191,191,224,231,
255,224,255,248,255,143,112,111,224,255,224,208,207,192,175,96,87,63,247,112,88,64,73,96,96,88,63,111,223,95,63,112,95,64,252,
87,127,127,255,159,159,159,223,216,223,0,0,255,143,103,96,176,175,143,127,104,253,79,189,80,80,63,31,79,64,31,241,79,121,96,
127,98,76,166,207,207,207,239,255,239,239,255,255,255,160,135,128,127,239,224,207,176,159,128,112,83,96,191,88,63,112,87,63,111,166,
96,88,127,48,127,88,63,63,31,16,252,83,24,100,96,124,80,219,80,0,0,0 }; 
//Total :1352 bytes.
unsigned char BITMAPARRAY3[] ={ 95,
66,77,70,44,0,242,242,54,242,240,117,40,249,244,94,242,240,1,0,24,242,242,205,16,241,240,196,14,18,3,26,5,41,41,255,
41,72,72,72,131,131,131,208,31,208,208,231,224,211,48,15,66,15,72,0,247,95,96,95,242,240,255,255,255,240,31,247,240,191,167,
144,102,15,120,15,132,6,252,90,3,36,3,134,134,134,200,200,200,56,72,15,183,15,192,3,128,136,128,93,3,96,0,192,192,0,
132,15,240,15,252,6,210,3,36,0,73,73,127,73,136,136,136,203,203,203,192,15,192,47,31,204,15,222,15,101,31,2,31,20,19,
141,141,15,141,209,209,209,56,31,167,31,68,31,176,31,248,221,31,182,31,20,19,146,146,146,210,210,1,210,236,31,31,47,188,31,
40,47,85,47,46,47,36,0,255,76,76,76,150,150,150,218,218,129,218,100,47,151,47,52,47,160,47,205,47,166,47,42,255,42,42,
75,75,75,147,147,147,7,220,220,220,220,47,15,63,172,47,24,63,69,63,252,30,63,244,35,156,156,156,214,214,214,128,84,63,135,
63,36,63,144,63,189,63,150,63,244,35,155,31,155,155,226,226,226,204,63,255,63,156,63,240,8,79,53,79,14,79,244,32,82,82,
82,162,31,162,162,224,224,224,68,79,119,79,20,79,240,128,79,173,79,134,79,244,32,83,83,83,164,31,164,164,228,228,228,188,79,
239,79,140,79,112,248,79,37,95,254,79,244,32,78,78,78,98,64,128,52,95,100,95,1,95,19,95,154,95,115,95,241,35,84,31,
84,84,167,167,167,172,95,220,95,121,95,112,139,95,18,111,235,95,241,38,177,177,177,36,111,192,84,111,241,95,3,111,138,111,99,
111,241,35,89,89,15,89,174,174,174,156,111,204,111,105,111,123,111,248,2,127,219,111,241,35,86,86,86,175,175,1,175,20,127,68,
127,225,111,243,111,122,127,83,127,209,70,128,186,111,185,127,146,127,104,127,239,127,1,143,238,38,93,31,93,93,180,180,180,4,143,
52,143,209,127,240,227,127,106,143,67,143,241,35,91,91,91,189,3,189,189,124,143,172,143,73,143,91,143,226,143,187,143,126,241,35,
96,96,96,191,191,191,244,143,192,36,159,193,143,211,143,90,159,51,159,241,35,102,102,15,102,192,192,192,108,159,156,159,57,159,75,
159,56,210,159,171,159,129,150,194,194,194,228,159,20,175,224,177,159,195,159,74,175,35,175,241,35,113,113,113,7,202,202,202,92,175,
140,175,41,175,59,175,194,175,28,155,175,241,35,110,110,110,122,175,1,191,218,175,240,176,175,55,191,73,191,238,38,118,118,118,207,
3,207,207,76,191,124,191,25,191,43,191,178,191,139,191,126,241,35,120,120,120,206,206,206,196,191,192,244,191,145,191,163,191,42,207,
3,207,241,35,126,126,15,126,216,216,216,60,207,108,207,9,207,27,207,0,162,207,123,207,241,35,42,0,253,47,225,207,186,207,144,
207,184,23,223,41,223,74,19,43,43,43,42,0,222,3,222,222,44,223,92,223,249,207,11,223,146,223,107,223,128,65,223,200,223,218,
223,119,223,254,223,16,239,173,223,139,3,139,139,28,239,73,239,34,239,248,223,127,239,145,239,0,182,214,146,16,148,239,193,239,154,
239,112,239,247,239,9,255,126,74,19,46,46,46,153,153,153,12,255,0,57,255,18,255,232,239,111,255,129,255,30,246,234,48,132,255,
192,177,255,138,255,96,255,231,255,249,255,74,19,48,48,207,48,154,154,154,252,255,41,15,239,239,127,239,223,223,223,208,215,208,68,
0,135,112,120,112,213,255,92,15,53,15,71,6,50,31,50,50,168,168,168,104,15,161,15,65,0,191,175,176,175,144,152,144,188,0,
80,3,87,80,77,15,212,15,173,15,191,6,140,0,218,64,28,224,15,25,28,15,16,15,43,31,200,15,79,31,156,40,31,106,19,
51,51,51,170,127,142,31,47,131,23,16,106,31,64,31,199,31,160,31,226,19,55,159,55,55,172,172,172,205,31,9,44,111,31,72,
64,96,111,111,169,31,187,31,66,47,156,27,47,226,16,54,54,54,50,127,126,47,127,63,95,95,144,152,159,111,31,43,48,47,248,
183,47,144,47,226,19,57,57,57,186,186,249,186,189,47,192,47,191,192,175,159,144,13,128,223,16,47,24,22,52,168,47,47,63,8,
63,142,23,51,61,61,61,154,143,110,63,207,32,208,255,207,191,191,167,144,79,47,31,27,79,48,142,50,47,31,32,63,167,63,128,
63,126,146,51,60,60,60,198,198,198,173,63,252,176,63,194,48,176,167,143,64,40,31,224,4,68,150,63,29,79,246,63,8,69,62,
62,62,7,201,201,201,37,79,40,79,58,79,16,79,151,79,252,112,79,130,67,70,70,70,208,208,208,120,157,79,160,79,178,65,160,
143,64,39,132,65,194,247,65,40,135,79,14,95,231,79,249,68,67,67,15,67,213,213,213,21,95,24,95,42,84,131,66,240,250,79,
129,95,90,95,108,89,72,72,72,219,3,219,219,141,95,144,95,178,79,120,95,255,95,216,95,14,234,83,76,76,76,5,111,62,111,
23,111,237,95,56,116,111,77,111,95,102,77,77,77,125,111,182,111,2,143,101,144,244,79,185,111,188,111,206,111,167,112,245,111,12,
46,127,191,49,208,176,209,97,109,95,47,127,53,127,142,71,126,86,86,86,109,127,166,127,143,108,79,112,99,111,218,127,179,127,197,
120,84,85,85,229,127,128,30,143,143,105,202,112,202,127,81,143,42,143,60,137,95,3,95,95,93,143,150,143,7,127,85,127,204,143,
165,143,0,183,134,15,144,213,143,14,159,127,119,181,143,15,159,21,159,14,39,158,106,106,106,77,159,134,159,143,111,69,143,56,188,
159,149,159,167,150,123,123,123,197,159,254,159,128,111,138,141,48,48,146,176,159,55,175,16,175,34,163,129,3,129,129,61,175,118,175,
231,143,53,159,172,175,133,175,142,151,166,136,136,136,181,175,238,175,207,32,207,1,207,40,159,162,175,41,191,2,191,216,175,95,191,
192,174,0,197,115,35,175,154,191,115,191,133,184,84,191,219,191,76,175,128,138,191,17,207,234,191,252,185,204,191,83,207,124,118,191,
1,168,11,178,77,117,8,207,143,207,104,207,15,179,68,207,0,203,207,60,180,111,192,10,191,132,207,210,207,228,207,82,191,0,65,
223,42,207,0,207,119,223,80,223,54,207,131,223,134,223,0,152,223,110,223,245,223,206,223,164,223,43,239,180,63,114,195,0,240,194,
149,63,108,239,69,239,87,230,36,239,171,239,28,218,0,240,195,91,239,226,239,187,239,205,232,156,239,35,255,180,188,0,223,211,213,
239,92,255,53,255,71,246,20,255,155,255,12,239,0,74,255,209,255,170,255,128,255,7,15,224,255,66,176,113,193,0,243,194,210,239,
73,15,34,15,52,9,4,15,139,15,100,13,128,208,239,191,15,152,15,170,11,124,15,3,31,188,56,143,0,178,3,226,209,246,207,
61,31,22,31,40,21,244,15,123,31,0,84,31,194,255,177,31,138,31,156,25,108,31,243,31,100,12,0,159,31,38,47,255,31,17,
44,228,31,107,47,252,236,23,47,0,158,47,119,47,137,44,92,47,227,47,188,57,140,47,233,47,96,236,47,254,47,212,47,91,63,
132,232,143,64,147,50,0,200,51,16,63,151,63,112,63,130,51,76,63,211,63,132,234,0,224,213,13,63,12,79,229,63,247,54,196,
63,75,79,52,60,0,175,15,126,79,87,79,5,255,141,79,198,79,55,63,117,79,0,252,79,213,79,67,63,50,95,11,95,121,49,
229,79,63,95,0,69,95,87,94,44,95,179,95,20,95,226,223,233,95,194,95,0,212,89,164,95,43,111,156,79,122,207,97,111,58,
111,76,105,0,28,111,163,111,124,111,218,95,217,111,178,111,196,105,148,111,0,27,127,140,95,202,97,134,63,85,127,46,127,64,117,
12,127,8,147,127,4,106,165,144,48,81,111,200,127,161,127,179,122,0,132,127,11,143,244,109,184,112,184,114,192,127,71,143,32,143,
0,183,115,252,127,131,143,244,111,66,127,185,143,146,143,164,137,8,116,143,251,143,164,195,223,55,127,177,143,56,159,17,159,0,231,
143,110,159,159,204,178,118,51,143,170,159,131,159,149,152,0,100,159,235,159,92,143,154,159,33,175,250,159,104,143,87,175,0,48,175,
42,70,167,143,150,175,111,175,129,172,84,175,219,175,0,236,247,26,159,148,175,226,175,244,175,202,175,81,191,2,107,1,79,149,159,
87,191,93,191,111,190,68,191,203,191,164,186,0,13,175,207,191,213,191,231,190,0 }; 
//Total :1947 bytes.  LSZ packed
//-----------------------------------------------------------------------------------------
CONTROLCLS::CONTROLCLS()
{
	for (long j=0;j<64;++j)
	{
    slHns[j]=0;///ctrl handles	   
    pressed_note[j]=0;
    pressed[j]=0;
	}
    BMPhsl=0;
    BMPdiez=0;
    BMPwtdown=0;
}
//-----------------------------------------------------------------------------------------
long CONTROLCLS::Decode(unsigned char *inpak,unsigned char* outdata,long ENDFA)
{
	int  i;
	int j;
	int k;
	int r;
	int c;
//	int N=4096;
	//int F=18;
//	int THRESHOLD=2;
	unsigned char text_buf[4113];	/* ring buffer of size N */

	unsigned int  flags;
	long y=0;
	long yt=0;
	long yz=0;
	for (i = 0; i < 4096 - 18; i++) text_buf[i] = ' ';

	r = 4096 - 18;  flags = 0;
	for ( ; ; ) {
		if (((flags >>= 1) & 256) == 0) {
			  if (yt++==ENDFA) break;
			  c=inpak[y++];
			  flags = c | 0xff00;
		}
		if (flags & 1)
		    {
			if (yt++==ENDFA) break;
			c=inpak[y++];
			outdata[yz++]=(unsigned char)c;///=w
		    text_buf[r++] = c;  r &= (4096 - 1);
		} else {
			  if (yt++==ENDFA) break;
			  i=inpak[y++];
			if (yt++==ENDFA) break;
			j=inpak[y++];
			i |= ((j & 0xf0) << 4);
		    j = (j & 0x0f) + 2;
			for (k = 0; k <= j; k++)
			    {
				c = text_buf[(i + k) & (4096 - 1)];
				outdata[yz++]=(unsigned char)c;///=w
			    text_buf[r++] = c;  r &= (4096 - 1);
			}
		}
	}
	return y;
}

//-----------------------------------------------------------------------------------------
int CONTROLCLS::handle2index_sl(HWND hS)
{
int k=0;
while (hS!=slHns[k]) ++k;
return k;
}
//-----------------------------------------------------------------------------------------
HANDLE CONTROLCLS::extro_lbs(HDC hDC,LPSTR bzin)
{
	HANDLE htoBmp;
	DWORD dwSize = 0;// Holds size of info structure
    BITMAPFILEHEADER* pBfh = 0;// Bitmap File Header Structure
    BITMAPINFOHEADER* pBih = 0;// Bitmap Info Header (points to beginning of pBmi)
    BITMAPCOREHEADER* pBch = 0;// Bitmap Core Header in case of other format
    BITMAPINFO*pBmi = 0;// Bitmap Info - Header and Colour Table
    BYTE* lpBits = 0;// Will be a pointer to the bitmap bits
    HBITMAP hBitmap = 0;// Bitmap handle which will be returned
    RGBQUAD* pRgb = 0;// Used with colour table
    long nrgbs;
    //////allocating structures
	 pBfh =(BITMAPFILEHEADER*) malloc(sizeof(BITMAPFILEHEADER));
	 pBih =(BITMAPINFOHEADER*) malloc(sizeof(BITMAPINFOHEADER));
	 pBmi =(BITMAPINFO*) malloc(sizeof(BITMAPINFO));

	 ///get BITMAPFILEHEADER - 14 bytes
	    memcpy(pBfh,&bzin[0],sizeof(BITMAPFILEHEADER));
	    if(pBfh->bfType!=0x4d42) // it isn't, free the file header
	    {
       MessageBox(0,"BMP header error","uups",0);
       return 0;
       }

	 ///get BITMAPINFOHEADER    - 40 bytes
	  memcpy(pBih, &bzin[sizeof(BITMAPFILEHEADER)],sizeof(BITMAPINFOHEADER));

	 ///get RGBQUAD
	  nrgbs = (36+pBfh->bfOffBits+sizeof(BITMAPINFOHEADER))/sizeof(RGBQUAD);
	  pRgb = (RGBQUAD*) malloc(nrgbs*sizeof(RGBQUAD));
	  memcpy(pRgb,&bzin[sizeof(BITMAPFILEHEADER)+sizeof(BITMAPINFOHEADER)],nrgbs*sizeof(RGBQUAD));

	 ////get BITMAPINFO
	 pBmi->bmiHeader =*pBih;
	 pBmi->bmiColors[0] =*pRgb;

	 htoBmp = CreateDIBitmap(hDC,pBih,CBM_INIT,&bzin[sizeof(BITMAPFILEHEADER)+pBfh->bfOffBits-14],pBmi,DIB_RGB_COLORS);

	 free(pBfh);
	 free(pBih);
	 free(pBmi);
	 return htoBmp;
}
//-----------------------------------------------------------------------------------------
void CONTROLCLS::gaa_diez(HWND hWin ,int octnum,int x_diez,int onoff)
{
BITMAP bm;
HDC hdc;
HDC hdcMemory;
GetObject(BMPdiez, sizeof(bm), &bm);
hdc = GetDC(hWin);
hdcMemory = CreateCompatibleDC(hdc);
SelectObject(hdcMemory, BMPdiez);
 
BitBlt( hdc,octnum*BMPLENGH+x_diez, 0,15,63,hdcMemory, 15*onoff,0 ,SRCCOPY );
 
DeleteDC(hdcMemory);
/////////////////
ReleaseDC(hWin, hdc);
}
//-----------------------------------------------------------------------------------------
void CONTROLCLS::gaa_white(HWND hWin ,int octnum,int num,int onoff)
{
BITMAP bm;
HDC hdc;
HDC hdcMemory;
GetObject(BMPwtdown, sizeof(bm), &bm);
hdc = GetDC(hWin);
hdcMemory = CreateCompatibleDC(hdc);
SelectObject(hdcMemory, BMPwtdown);
if ((num==0)|(num==3)) 
   BitBlt( hdc,octnum*BMPLENGH+20*num+1, 2,20,94,hdcMemory, 20*onoff,0 ,SRCCOPY );///DO&FA
else BitBlt( hdc,octnum*BMPLENGH+20*num+1, 62,20,34,hdcMemory, 20*onoff,60 ,SRCCOPY );
 
DeleteDC(hdcMemory);
/////////////////
ReleaseDC(hWin, hdc);
}
//-----------------------------------------------------------------------------------------
void CONTROLCLS::gaa_sl (HWND hWin )
{
BITMAP bm;
HDC hdc;
HDC hdcMemory;
GetObject(BMPhsl, sizeof(bm), &bm);
hdc = GetDC(hWin);
hdcMemory = CreateCompatibleDC(hdc);
SelectObject(hdcMemory, BMPhsl);
 
BitBlt( hdc,0, 0,BMPLENGH,BMPHIGH,hdcMemory, 0,0 ,SRCCOPY );
BitBlt( hdc,BMPLENGH, 0,BMPLENGH,BMPHIGH,hdcMemory, 0,0,SRCCOPY );
BitBlt( hdc,2*BMPLENGH, 0,BMPLENGH,BMPHIGH,hdcMemory, 0,0,SRCCOPY );
BitBlt( hdc,3*BMPLENGH, 0,BMPLENGH,BMPHIGH,hdcMemory, 0,0,SRCCOPY );

DeleteDC(hdcMemory);
/////////////////
ReleaseDC(hWin, hdc);
}
//-----------------------------------------------------------------------------------------
LONG CALLBACK CONTROLCLS::HandleKeyboard(HWND hW, UINT msg, WPARAM wParam, LPARAM lParam)
{
 int ind=0;
 int value=0;
 PAINTSTRUCT ps;
 HDC hdc;
 TRACKMOUSEEVENT tme;
	switch (msg) {
            case WM_PAINT:
			{
			CONTROLCLS * a = (CONTROLCLS*)GetWindowLong(hW, GWL_USERDATA);
            //if (a) ind = a->handle2index_sl(hW);
		    hdc = BeginPaint(hW, &ps);
            BITMAP bm;
            HDC hdcMemory;
            GetObject(a->BMPhsl, sizeof(bm), &bm);
            hdcMemory = CreateCompatibleDC(hdc);
		    SelectObject(hdcMemory, a->BMPhsl);
			//int number=a->changle_hsl[ind];
BitBlt( hdc,0, 0,BMPLENGH,BMPHIGH,hdcMemory, 0,0 ,SRCCOPY );
BitBlt( hdc,BMPLENGH, 0,BMPLENGH,BMPHIGH,hdcMemory, 0,0,SRCCOPY );
BitBlt( hdc,2*BMPLENGH, 0,BMPLENGH,BMPHIGH,hdcMemory, 0,0,SRCCOPY );
BitBlt( hdc,3*BMPLENGH, 0,BMPLENGH,BMPHIGH,hdcMemory, 0,0,SRCCOPY ); 

            DeleteDC(hdcMemory);
            ReleaseDC(hW, hdc);
			EndPaint(hW, &ps);
			}
			return 0L;
         case WM_LBUTTONDOWN:
			 {
			int note=(short int)LOWORD(lParam)/BMPLENGH*12 ;	
			CONTROLCLS * a = (CONTROLCLS*)GetWindowLong(hW, GWL_USERDATA);
			if (a) ind = a->handle2index_sl(hW);
			if (HIWORD(lParam)<55) ////DIEZ
			{
          
		    switch  ((int) ((( (short int)LOWORD(lParam)%BMPLENGH) -5)*0.1))
			{
			    case 1: 
				a->gaa_diez( hW ,(short int)LOWORD(lParam)/BMPLENGH ,14,0);
				note+=1;
				break;
			case 3: 
				a->gaa_diez( hW ,(short int)LOWORD(lParam)/BMPLENGH ,34,0);
				note+=3;
				break;
			case 7: 
				a->gaa_diez( hW ,(short int)LOWORD(lParam)/BMPLENGH ,74,0);
				note+=6;
				break;
			case 9: 
				a->gaa_diez( hW ,(short int)LOWORD(lParam)/BMPLENGH ,94,0);
				note+=8;
				break;
			case 11:
				a->gaa_diez( hW ,(short int)LOWORD(lParam)/BMPLENGH ,114,0);
				note+=10;
				break;
			} 
			}
			else   ////WHITE
			{
			int whitenum=( (short int)LOWORD(lParam)%BMPLENGH)*0.05;
            a->gaa_white( hW ,(short int)LOWORD(lParam)/BMPLENGH ,
				whitenum,0);
			if (whitenum<3) note+= whitenum*2;
			else note+= whitenum*2-1;
			}
			a->pressed_note[ind]=note;
            ////message
            msg= WM_MIDIKEYPRESSED;
            wParam= ind;
            lParam= note;
			 }
            break;

            
		     case WM_MOUSELEAVE:
		 	 {
             CONTROLCLS * a = (CONTROLCLS*)GetWindowLong(hW, GWL_USERDATA);
			 if (a) ind = a->handle2index_sl(hW);
	         a->gaa_sl ( hW );
             
		     ///ALL OFF
			 ////message
            msg= WM_MIDIKEYUP;
            wParam= ind;
            lParam= a->pressed_note[ind];
			 }
            break;

		     case WM_LBUTTONUP:
			 {
             CONTROLCLS * a = (CONTROLCLS*)GetWindowLong(hW, GWL_USERDATA);
			 if (a) ind = a->handle2index_sl(hW);
	         a->gaa_sl ( hW );
             
		     ///ALL OFF
			 ////message
            msg= WM_MIDIKEYUP;
            wParam= ind;
            lParam= a->pressed_note[ind];
			 }
            break;

            case WM_MOUSEMOVE:
            if (wParam==MK_LBUTTON	)
            {
			tme.cbSize = sizeof(TRACKMOUSEEVENT);
            tme.dwFlags = TME_LEAVE;
            tme.hwndTrack = hW;
            _TrackMouseEvent(&tme);

		    CONTROLCLS * a = (CONTROLCLS*)GetWindowLong(hW, GWL_USERDATA);
			if (a) ind = a->handle2index_sl(hW);

				////DIEZ
				 if (HIWORD(lParam)<55)
				 {
            
		    switch  ((int) ((( (short int)LOWORD(lParam)%BMPLENGH) -5)*0.1))
			{
			case 1: a->gaa_diez( hW ,(short int)LOWORD(lParam)/BMPLENGH ,14,0);break;
			case 3: a->gaa_diez( hW ,(short int)LOWORD(lParam)/BMPLENGH ,34,0);break;
			case 7: a->gaa_diez( hW ,(short int)LOWORD(lParam)/BMPLENGH ,74,0);break;
			case 9: a->gaa_diez( hW ,(short int)LOWORD(lParam)/BMPLENGH ,94,0);break;
			case 11:a->gaa_diez( hW ,(short int)LOWORD(lParam)/BMPLENGH ,114,0);break;
			case 2: a->gaa_sl ( hW );break;///ALL OFF
            case 4: a->gaa_sl ( hW );break;///ALL OFF
	        case 5: a->gaa_sl ( hW );break;///ALL OFF
		    case 6: a->gaa_sl ( hW );break;///ALL OFF
			case 8: a->gaa_sl ( hW );break;///ALL OFF
			case 10: a->gaa_sl ( hW );break;///ALL OFF
			}
                 } else
				 {
                 a->gaa_white( hW ,a->pressed[ind]/12 ,
				   a->pressed[ind]%12,1);////OFF previously pressed
                 a->gaa_white( hW ,(short int)LOWORD(lParam)/BMPLENGH ,
				 ( (short int)LOWORD(lParam)%BMPLENGH)*0.05,0);///KEYDOWN
				 a->pressed[ind] = (short int)LOWORD(lParam)/BMPLENGH*12+
					 ((short int)LOWORD(lParam)%BMPLENGH)*0.05;
				 }
					 
		
			}			
            break;
            case WM_ERASEBKGND:   //////Compulsary
            return 0;
			
          case WM_DESTROY:
		  {
	      char tclnm[30];
	      GetClassName(hW,&tclnm[0], 30);
          UnregisterClass(&tclnm[0], (HINSTANCE) GetWindowLong(hW, GWL_HINSTANCE));
		  }
	      return FALSE;
	}

  
   ///// back to windows procedure of parent window
	return CallWindowProc((WNDPROC)  GetWindowLong((HWND)GetParent(hW), GWL_WNDPROC),	
    hW,msg,wParam,lParam );
}
//-----------------------------------------------------------------------------------------
void CONTROLCLS::SetAllOff(int ind )
{
gaa_sl (slHns[ind]);			
} ///
//-----------------------------------------------------------------------------------------
void CONTROLCLS::SetNoteOff(int ind ,int note)
{
note-=48;	
 switch  (note%12)
			{
	        case 0:  gaa_white(slHns[ind] ,note/12,0,1);break;
			case 1:  gaa_diez( slHns[ind] ,note/12 ,14,1);break;
            case 2:  gaa_white(slHns[ind] ,note/12,1,1);break;
			case 3:  gaa_diez( slHns[ind] ,note/12,34,1);break;
            case 4:  gaa_white(slHns[ind] ,note/12,2,1);break;
            case 5:  gaa_white(slHns[ind] ,note/12,3,1);break;
			case 6:  gaa_diez( slHns[ind] ,note/12,74,1);break;
            case 7:  gaa_white(slHns[ind] ,note/12,4,1);break;
			case 8:  gaa_diez( slHns[ind] ,note/12 ,94,1);break;
            case 9:  gaa_white(slHns[ind] ,note/12,5,1);break;
			case 10: gaa_diez( slHns[ind] ,note/12,114,1);break;
            case 11:  gaa_white(slHns[ind] ,note/12,6,1);break;
		
			}
			
} ///
//-----------------------------------------------------------------------------------------
void CONTROLCLS::SetNoteOn(int ind ,int note)  ///ind from 0
{
note-=48;	
 switch  (note%12)
			{
			case 0:  gaa_white(slHns[ind] ,note/12,0,0);break;
            case 1:  gaa_diez( slHns[ind] ,note/12 ,14,0);break;
            case 2:  gaa_white(slHns[ind] ,note/12,1,0);break;
			case 3:  gaa_diez( slHns[ind] ,note/12,34,0);break;
            case 4:  gaa_white(slHns[ind] ,note/12,2,0);break;
            case 5:  gaa_white(slHns[ind] ,note/12,3,0);break;
			case 6:  gaa_diez( slHns[ind] ,note/12,74,0);break;
            case 7:  gaa_white(slHns[ind] ,note/12,4,0);break;
			case 8:  gaa_diez( slHns[ind] ,note/12 ,94,0);break;
            case 9:  gaa_white(slHns[ind] ,note/12,5,0);break;
			case 10: gaa_diez( slHns[ind] ,note/12,114,0);break;
            case 11:  gaa_white(slHns[ind] ,note/12,6,0);break;
		
			}
} ///
//-----------------------------------------------------------------------------------------
HWND CONTROLCLS::add_keyboard(HWND hParent, int a,int b, int id)
{
	HWND hwnD;
    HDC hhDC; 
	char *cl_nm;
	char bbuf[10];
	cl_nm = (char*) malloc(32);
	memset(cl_nm ,0,32);
	itoa(id,&bbuf[0],10);
	strcat(cl_nm,CNTRLCLSNAME);
	strcat(cl_nm,&bbuf[0]);
//    numdigits[id]=umdigits_a;
////MessageBox(0,cl_nm,"Class Name",0); 

    WNDCLASS wc_id;
    memset(&wc_id,0,sizeof(wc_id));
	wc_id.lpfnWndProc       =      HandleKeyboard;
	wc_id.style             =      0;
	wc_id.lpszMenuName      =      NULL;
	wc_id.hInstance         =      (HINSTANCE)  hInstance;
	wc_id.cbWndExtra        =      0;
	wc_id.hCursor           =      0;
	wc_id.hbrBackground     =      NULL;
	wc_id.lpszClassName     =      (LPSTR) cl_nm;///

    RegisterClass(&wc_id);

   hwnD = CreateWindow(
   (LPSTR) cl_nm, (LPSTR) NULL,
    WS_CHILD | WS_VISIBLE,
    a,b,num_octaves*BMPLENGH,BMPHIGH,
    (HWND)hParent,(HMENU) (int) id+100,
    (HINSTANCE)hInstance, NULL);
    ////if (hwnD==0) MessageBox(0,"Keyboard suxed","IJ",0);
	if (cl_nm!=NULL) free(cl_nm);
    SetWindowLong(hwnD, GWL_USERDATA, (long) this);

		     /////// --------- EXCLUDE BACKGROUND PIXELS
            if ((BMPhsl==0)|(BMPdiez==0)|(BMPwtdown==0))
			 {
                /////// ---------
			    hhDC = GetDC(hwnD);
			    unsigned char *bmparr;
			    bmparr=(unsigned char*)malloc(65536);
			    Decode(BITMAPARRAY,bmparr,5155);
			    BMPhsl=extro_lbs(hhDC,(char*)bmparr);
    
                Decode(BITMAPARRAY2,bmparr,1352);
				BMPdiez=extro_lbs(hhDC,(char*)bmparr);

				Decode(BITMAPARRAY3,bmparr,1947);
				BMPwtdown=extro_lbs(hhDC,(char*)bmparr);
	            ReleaseDC(hwnD, hhDC);
                free(bmparr);
			}
				pressed[id]=0;

slHns[id]=hwnD;
return hwnD;

}
//-----------------------------------------------------------------------------------------
#undef CONTROLCLS 
#undef BMPLENGH 
#undef BMPHIGH 
#undef CNTRLCLSNAME 
#undef BITMAPARRAY 
#undef BITMAPARRAY2 
#undef BITMAPARRAY3 
#undef num_octaves
//-----------------------------------------------------------------------------------------
